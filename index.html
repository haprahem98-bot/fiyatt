<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>ğŸ’° Fiyat HesaplayÄ±cÄ± - Firebase Modular</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; padding: 20px; color: #333; }

  h2 { margin-bottom: 20px; color: #1a73e8; }
  h3 { margin-top: 20px; color: #1a73e8; }

  /* Inputs & Buttons */
  input { padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; text-align: center; transition: all 0.2s; }
  input:focus { border-color: #1a73e8; outline: none; box-shadow: 0 0 5px rgba(26,115,232,0.4); }
  .header-input { margin-right: 10px; width: 180px; }

  button { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; background: #1a73e8; color: #fff; font-weight: bold; transition: 0.2s; }
  button:hover { background: #155ab6; }

  /* Table */
  .table-wrapper { overflow-x: auto; margin-top: 15px; }
  table { width: 100%; border-collapse: collapse; min-width: 600px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden; }
  th, td { padding: 12px 8px; text-align: center; border-bottom: 1px solid #ddd; }
  th { background: #1a73e8; color: #fff; font-weight: 600; }
  td { background: #fff; transition: background 0.2s; }
  td input { width: 80px; }

  .total { font-weight: bold; color: #00a153; }
  #savedModels div { margin-bottom: 8px; }
  #savedModels button { margin: 2px; background: #f44336; }
  #savedModels button:hover { background: #c12b1c; }

  #searchResults { border: 1px solid #ccc; background: #fff; position: absolute; max-height: 150px; overflow-y: auto; display: none; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
  #searchResults div { padding: 8px 12px; cursor: pointer; }
  #searchResults div:hover { background: #f0f2f5; }

  .search-container { position: relative; display: inline-block; margin-top: 10px; }

  /* Misc */
  button.delete-btn { background: #f44336; }
  button.delete-btn:hover { background: #c12b1c; }
  .control-buttons { margin-top: 15px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }

  /* ---- Responsive ---- */
  @media (max-width: 768px) {
    .header-input { width: 100%; margin-bottom: 10px; }
    .control-buttons { flex-direction: column; align-items: stretch; }
    td input { width: 60px; }
    .table-wrapper { overflow-x: auto; }
  }
</style>
</head>
<body>

<h2>ğŸ’° Dolar - TL Fiyat HesaplayÄ±cÄ±</h2>

<div class="control-buttons">
  <label>Model: <input type="text" id="model" class="header-input" placeholder="Model adÄ±"></label>
  <label>Dolar kuru (TL): <input type="number" id="dollarRate" value="42.290" step="0.01" class="header-input" oninput="calculateAll()"></label>
  <button type="button" onclick="saveModel()">ğŸ’¾ Kaydet</button>
  <button type="button" onclick="clearFields()">ğŸ§¹ Temizle</button>
</div>

<div class="search-container">
  <label>Arama: <input type="text" id="searchInput" placeholder="Model ara" oninput="showSuggestions()" autocomplete="off"></label>
  <div id="searchResults"></div>
</div>

<div class="control-buttons" style="margin-top:10px;">
  <button type="button" onclick="addRow()">â• Yeni SatÄ±r / Ø¥Ø¶Ø§ÙØ© ØµÙ</button>
</div>

<div class="table-wrapper">
  <table>
    <thead>
      <tr>
        <th>TÃ¼r</th>
        <th>Dolar FiyatÄ±</th>
        <th>TL KarÅŸÄ±lÄ±ÄŸÄ±</th>
        <th>KÃ¢r (TL)</th>
        <th>Toplam (TL)</th>
        <th>Ä°ÅŸlem</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<h3>ğŸ§® Genel Toplam: <span id="grandTotal" style="font-size:22px;">0</span> TL</h3>

<div id="savedModels">
  <h3>ğŸ’¾ Kaydedilen Modeller:</h3>
</div>

<!-- Firebase & JS (Ù„Ø§ ÙŠØªØºÙŠØ±) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, doc, setDoc, getDoc, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC6ZpIkEi9KMErwJpw2HFK-Wj51dcP6-S0",
    authDomain: "price-calculator-f17c7.firebaseapp.com",
    projectId: "price-calculator-f17c7",
    storageBucket: "price-calculator-f17c7.firebasestorage.app",
    messagingSenderId: "541750328906",
    appId: "1:541750328906:web:755597e8f21164492f70b3"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let rowCount = 0;

  window.addRow = function(name="Yeni Model", usdValue=0, profitValue=0) {
    rowCount++;
    const tableBody = document.getElementById('tableBody');
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="text" value="${name}" oninput="calculateAll()"></td>
      <td><input type="number" id="usd${rowCount}" value="${usdValue}" oninput="calculateAll()"></td>
      <td id="tl${rowCount}">0</td>
      <td><input type="number" id="profit${rowCount}" value="${profitValue}" oninput="calculateAll()"></td>
      <td id="total${rowCount}" class="total">0 TL (${name})</td>
      <td><button class="delete-btn" onclick="window.deleteRow(this)">ğŸ—‘ï¸ Sil</button></td>
    `;
    tableBody.appendChild(tr);
  };

  window.deleteRow = function(button) {
    button.closest('tr').remove();
    calculateAll();
  };

  window.calculateAll = function() {
    const rate = parseFloat(document.getElementById('dollarRate').value) || 0;
    let grandTotal = 0;
    document.querySelectorAll('#tableBody tr').forEach((tr) => {
      const usd = parseFloat(tr.querySelector('input[id^="usd"]').value) || 0;
      const profit = parseFloat(tr.querySelector('input[id^="profit"]').value) || 0;
      const name = tr.querySelector('td:first-child input').value;
      const tl = usd * rate;
      const total = tl + profit;
      tr.querySelector('td[id^="tl"]').innerText = tl.toFixed(2);
      tr.querySelector('td[id^="total"]').innerText = `${total.toFixed(2)} TL (${name})`;
      grandTotal += total;
    });
    document.getElementById('grandTotal').innerText = grandTotal.toFixed(2);
  };

  window.clearFields = function() {
    document.getElementById('model').value = "";
    document.getElementById('tableBody').innerHTML = "";
    rowCount = 0;
    addRow();
    calculateAll();
  };

  // Firebase functions
  window.saveModel = async function() {
    const modelName = document.getElementById('model').value.trim();
    if (!modelName) { alert("LÃ¼tfen model adÄ±nÄ± girin."); return; }
    const data = { rows: [] };
    document.querySelectorAll('#tableBody tr').forEach(tr => {
      const name = tr.querySelector('td:first-child input').value;
      const usd = parseFloat(tr.querySelector('input[id^="usd"]').value) || 0;
      const profit = parseFloat(tr.querySelector('input[id^="profit"]').value) || 0;
      data.rows.push({ name, usd, profit });
    });
    await setDoc(doc(db, "models", modelName), data);
    alert(`Model "${modelName}" Firebase'e kaydedildi!`);
    updateSavedModelsList();
  }

  window.loadModel = async function(modelName) {
    const docSnap = await getDoc(doc(db, "models", modelName));
    if (!docSnap.exists()) { alert("Model bulunamadÄ±!"); return; }
    const data = docSnap.data();
    document.getElementById('model').value = modelName;
    document.getElementById('tableBody').innerHTML = "";
    rowCount = 0;
    data.rows.forEach(r => addRow(r.name, r.usd, r.profit));
    calculateAll();
  }

  window.deleteModel = async function(modelName) {
    if (!confirm(`"${modelName}" silinsin mi?`)) return;
    await deleteDoc(doc(db, "models", modelName));
    updateSavedModelsList();
    alert(`"${modelName}" silindi!`);
  }

  window.updateSavedModelsList = async function() {
    const container = document.getElementById('savedModels');
    container.innerHTML = "<h3>ğŸ’¾ Kaydedilen Modeller:</h3>";
    const snapshot = await getDocs(collection(db, "models"));
    snapshot.forEach(docItem => {
      const div = document.createElement('div');
      const btnLoad = document.createElement('button');
      btnLoad.textContent = docItem.id;
      btnLoad.onclick = () => loadModel(docItem.id);
      const btnDelete = document.createElement('button');
      btnDelete.textContent = "Sil";
      btnDelete.onclick = () => deleteModel(docItem.id);
      div.appendChild(btnLoad);
      div.appendChild(btnDelete);
      container.appendChild(div);
    });
  }

  window.showSuggestions = async function() {
    const input = document.getElementById('searchInput');
    const results = document.getElementById('searchResults');
    const val = input.value.trim().toLowerCase();
    results.innerHTML = "";
    if (!val) { results.style.display = "none"; return; }
    const snapshot = await getDocs(collection(db, "models"));
    const models = snapshot.docs.map(d => d.id);
    const matches = models.filter(m => m.toLowerCase().startsWith(val));
    if (!matches.length) { results.style.display = "none"; return; }
    matches.forEach(m => {
      const div = document.createElement('div');
      div.textContent = m;
      div.onclick = () => { loadModel(m); input.value = ""; results.style.display = "none"; };
      results.appendChild(div);
    });
    results.style.display = "block";
  }

  document.addEventListener('click', e => {
    if (!document.querySelector('.search-container').contains(e.target)) {
      document.getElementById('searchResults').style.display = "none";
    }
  });

  // Init
  updateSavedModelsList();
  addRow();
</script>

</body>
</html>
